<html><head><title>Emil: Creating Mails</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="eikek" /><meta name="description" content="Emil – E-Mail library for Scala" /><meta name="og:image" content="/emil/img/poster.png" /><meta name="image" property="og:image" content="/emil/img/poster.png" /><meta name="og:title" content="Emil: Creating Mails" /><meta name="title" property="og:title" content="Emil: Creating Mails" /><meta name="og:site_name" content="Emil" /><meta name="og:url" content="https://github.com/eikek/emil" /><meta name="og:type" content="website" /><meta name="og:description" content="Emil – E-Mail library for Scala" /><link rel="icon" type="image/png" href="/emil/img/favicon.png" /><meta name="twitter:title" content="Emil: Creating Mails" /><meta name="twitter:image" content="/emil/img/poster.png" /><meta name="twitter:description" content="Emil – E-Mail library for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="96x96" href="/emil/img/favicon.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/emil/highlight/styles/vs.css" /><link rel="stylesheet" href="/emil/css/light-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/emil/" class="brand"><div class="brand-wrapper"></div><span>Emil</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/emil/index.html" title="Home" class="">Home</a></div> <div class="sidebar-nav-item  "><a href="/emil/examples.html" title="Examples" class="">Examples</a></div> <div class="sidebar-nav-item  open"><a href="/emil/doc.html" title="Documentation" class="drop-nested">Documentation</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/emil/doc/building.html" title="Creating Mails" class="active">Creating Mails</a> <a href="/emil/doc/reading.html" title="Obtaining Mails" class="">Obtaining Mails</a> <a href="/emil/doc/syntax.html" title="Syntax Utilities" class="">Syntax Utilities</a></div></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/eikek/emil" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/eikek/emil" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="eikek" data-github-repo="emil"><div class="content-wrapper"><section><h1 id="creating-mails">Creating Mails</h1>

<p>The <code class="highlighter-rouge">Mail</code> class in <code class="highlighter-rouge">emil-common</code> is used to represent an
e-mail. Using the <code class="highlighter-rouge">MailBuilder</code> makes creating values more
convenient. The <code class="highlighter-rouge">MailBuilder</code> works by collecting a list of
transformations to an initial <code class="highlighter-rouge">Mail</code> object and applying them when
invoking the <code class="highlighter-rouge">build</code> method. There exists a set of predefined
transformations to cover the most common things. But you can create
your own easily, too.</p>

<h2 id="simple-mails">Simple Mails</h2>

<p>Creating mails without attachments:</p>

<pre><code class="language-tut:book">import cats.effect._, emil._, emil.builder._

val mail: Mail[IO] = MailBuilder.build(
  From("me@test.com"),
  To("test@test.com"),
  Subject("Hello!"),
  CustomHeader(Header("User-Agent", "my-email-client")),
  TextBody("Hello!\n\nThis is a mail."),
  HtmlBody("&lt;h1&gt;Hello!&lt;/h1&gt;\n&lt;p&gt;This &lt;b&gt;is&lt;/b&gt; a mail.&lt;/p&gt;")
)
</code></pre>

<p>The <code class="highlighter-rouge">Mail</code> defines an effect type, because the attachments and the
mail body does. Using <code class="highlighter-rouge">MailBuilder.build</code> already applies all
transformations and yields the final <code class="highlighter-rouge">Mail</code> instance. Using the
<code class="highlighter-rouge">MailBuilder.apply</code> instead, would return the <code class="highlighter-rouge">MailBuilder</code> instance
which can be further modified. It is also possible to go from an
existing <code class="highlighter-rouge">Mail</code> to a <code class="highlighter-rouge">MailBuilder</code> to change certain parts:</p>

<pre><code class="language-tut:book">val builder = mail.asBuilder
val mail2 = builder.
  clearRecipients.
  add(To("me2@test.com")).
  set(Subject("Hello 2")).
  build
</code></pre>

<p>The <code class="highlighter-rouge">add</code> and <code class="highlighter-rouge">set</code> methods are both doing the same thing: appending
transfomations. Both names exists for better reading; i.e. a recipient
is by default appended, but the subject is not. The methods accept a
list of transformations, too.</p>

<pre><code class="language-tut:book">val mail3 = mail2.asBuilder.
  clearRecipients.
  add(
    To("me3@test.com"),
    Cc("other@test.com")
  ).
  build
</code></pre>

<h2 id="mails-with-attachments">Mails with Attachments</h2>

<p>Adding attachments is the same as with other data. Creating
attachemnts might be more involved, depending on where the data is
coming from. Emil defines transformations to add attachments from
files, urls and java’s <code class="highlighter-rouge">InputStream</code> easily. Otherwise you need to get
a <code class="highlighter-rouge">Stream[F, Byte]</code> from somewhere else.</p>

<pre><code class="language-tut:book">import scala.concurrent.ExecutionContext

implicit val CS = IO.contextShift(ExecutionContext.global)
val blocker = Blocker.liftExecutionContext(ExecutionContext.fromExecutorService(java.util.concurrent.Executors.newCachedThreadPool()))

val mail4 = mail3.asBuilder.add(
  AttachUrl[IO](getClass.getResource("/files/Test.pdf"), blocker).
    withFilename("test.pdf").
    withMimeType(MimeType.pdf)).
  build
</code></pre>

<p>Emil creates a <code class="highlighter-rouge">Stream[F, Byte]</code> from the <code class="highlighter-rouge">java.net.URL</code> using the
<a href="https://github.com/functional-streams-for-scala/fs2/tree/master/io/src">fs2-io</a>
api, that requires a <code class="highlighter-rouge">Blocker</code> and a <code class="highlighter-rouge">ContextShift</code>. The same applies
when attaching files and <code class="highlighter-rouge">java.io.InputStream</code>s.</p>

<p>Attaching any given <code class="highlighter-rouge">Stream[F, Byte]</code> is the same. It doesn’t require
<code class="highlighter-rouge">Blocker</code> or <code class="highlighter-rouge">ContextShift</code> then.</p>

<pre><code class="language-tut:book">import fs2.Stream

val mydata: Stream[IO, Byte] = Stream.empty.covary[IO]

val mail5 = mail4.asBuilder.
  clearAttachments.
  add(
    Attach(mydata).
      withFilename("empty.txt")
  ).
  build
</code></pre>

<h2 id="custom-transformations">Custom Transformations</h2>

<p>Customs transformations can be easily created. It’s only a function
<code class="highlighter-rouge">Mail[F] =&gt; Mail[F]</code>. This can be handy, if there is a better way to
retrieve attachments, or just to create common headers.</p>

<pre><code class="language-tut:book">object MyHeader {
  def apply[F[_]](value: String): Trans[F] =
    CustomHeader("X-My-Header", value)
}

val mymail = MailBuilder.build(
  To("me@test.com"),
  MyHeader("blablabla"),
  TextBody("This is a text")
)
</code></pre>

<p>The above example simply delegates to an existing <code class="highlighter-rouge">Trans</code> constructor.</p>
</section></div></div></div></div><script src="/emil/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
              </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/emil/js/docs.js"></script></body></html>