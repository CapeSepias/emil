<html><head><title>Emil: Creating Mails</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="eikek" /><meta name="description" content="Emil – E-Mail library for Scala" /><meta name="og:image" content="/emil/img/poster.png" /><meta name="image" property="og:image" content="/emil/img/poster.png" /><meta name="og:title" content="Emil: Creating Mails" /><meta name="title" property="og:title" content="Emil: Creating Mails" /><meta name="og:site_name" content="Emil" /><meta name="og:url" content="https://github.com/eikek/emil" /><meta name="og:type" content="website" /><meta name="og:description" content="Emil – E-Mail library for Scala" /><link rel="icon" type="image/png" href="/emil/img/favicon.png" /><meta name="twitter:title" content="Emil: Creating Mails" /><meta name="twitter:image" content="/emil/img/poster.png" /><meta name="twitter:description" content="Emil – E-Mail library for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="96x96" href="/emil/img/favicon.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/emil/highlight/styles/default.css" /><link rel="stylesheet" href="/emil/css/style.css" /><link rel="stylesheet" href="/emil/css/palette.css" /><link rel="stylesheet" href="/emil/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/emil/" class="brand"><div class="brand-wrapper"><span>Emil</span></div></a></li> <li><a href="/emil/index.html" class="">Home</a></li> <li><a href="/emil/examples.html" class="">Examples</a></li> <li><a href="/emil/doc.html" class="">Documentation</a> <ul class="sub_section"> <li><a href="/emil/doc/building.html" class=" active ">Creating Mails</a></li> <li><a href="/emil/doc/reading.html" class="">Obtaining Mails</a></li> <li><a href="/emil/doc/syntax.html" class="">Syntax Utilities</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/eikek/emil"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/eikek/emil"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="eikek" data-github-repo="emil"><div class="content-wrapper"><section><h1 id="creating-mails">Creating Mails</h1>

<p>The <code class="highlighter-rouge">Mail</code> class in <code class="highlighter-rouge">emil-common</code> is used to represent an
e-mail. Using the <code class="highlighter-rouge">MailBuilder</code> makes creating values more
convenient. The <code class="highlighter-rouge">MailBuilder</code> works by collecting a list of
transformations to an initial <code class="highlighter-rouge">Mail</code> object and applying them when
invoking the <code class="highlighter-rouge">build</code> method. There exists a set of predefined
transformations to cover the most common things. But you can create
your own easily, too.</p>

<h2 id="simple-mails">Simple Mails</h2>

<p>Creating mails without attachments:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.effect._</span><span class="o">,</span> <span class="nv">emil</span><span class="o">.</span><span class="py">_</span><span class="o">,</span> <span class="nv">emil</span><span class="o">.</span><span class="py">builder</span><span class="o">.</span><span class="py">_</span>
<span class="c1">// import cats.effect._
// import emil._
// import emil.builder._
</span>
<span class="k">val</span> <span class="nv">mail</span><span class="k">:</span> <span class="kt">Mail</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span> <span class="k">=</span> <span class="nv">MailBuilder</span><span class="o">.</span><span class="py">build</span><span class="o">(</span>
  <span class="nc">From</span><span class="o">(</span><span class="s">"me@test.com"</span><span class="o">),</span>
  <span class="nc">To</span><span class="o">(</span><span class="s">"test@test.com"</span><span class="o">),</span>
  <span class="nc">Subject</span><span class="o">(</span><span class="s">"Hello!"</span><span class="o">),</span>
  <span class="nc">CustomHeader</span><span class="o">(</span><span class="nc">Header</span><span class="o">(</span><span class="s">"User-Agent"</span><span class="o">,</span> <span class="s">"my-email-client"</span><span class="o">)),</span>
  <span class="nc">TextBody</span><span class="o">(</span><span class="s">"Hello!\n\nThis is a mail."</span><span class="o">),</span>
  <span class="nc">HtmlBody</span><span class="o">(</span><span class="s">"&lt;h1&gt;Hello!&lt;/h1&gt;\n&lt;p&gt;This &lt;b&gt;is&lt;/b&gt; a mail.&lt;/p&gt;"</span><span class="o">)</span>
<span class="o">)</span>
<span class="c1">// mail: emil.Mail[cats.effect.IO] =
// Mail(MailHeader(,None,None,Recipients(List(MailAddress(None,test@test.com)),List(),List()),None,Some(MailAddress(None,me@test.com)),None,None,None,Hello!,Set()),Headers(List(Header(User-Agent,NonEmptyList(my-email-client)))),HtmlAndText(IO(Hello!
// 
// This is a mail.),IO(&lt;h1&gt;Hello!&lt;/h1&gt;
// &lt;p&gt;This &lt;b&gt;is&lt;/b&gt; a mail.&lt;/p&gt;)),Attachments(Vector()))
</span></code></pre></div></div>

<p>The <code class="highlighter-rouge">Mail</code> defines an effect type, because the attachments and the
mail body does. Using <code class="highlighter-rouge">MailBuilder.build</code> already applies all
transformations and yields the final <code class="highlighter-rouge">Mail</code> instance. Using the
<code class="highlighter-rouge">MailBuilder.apply</code> instead, would return the <code class="highlighter-rouge">MailBuilder</code> instance
which can be further modified. It is also possible to go from an
existing <code class="highlighter-rouge">Mail</code> to a <code class="highlighter-rouge">MailBuilder</code> to change certain parts:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">builder</span> <span class="k">=</span> <span class="nv">mail</span><span class="o">.</span><span class="py">asBuilder</span>
<span class="c1">// builder: emil.builder.MailBuilder[cats.effect.IO] = emil.builder.MailBuilder@67d2940e
</span>
<span class="k">val</span> <span class="nv">mail2</span> <span class="k">=</span> <span class="n">builder</span><span class="o">.</span>
  <span class="n">clearRecipients</span><span class="o">.</span>
  <span class="nf">add</span><span class="o">(</span><span class="nc">To</span><span class="o">(</span><span class="s">"me2@test.com"</span><span class="o">)).</span>
  <span class="nf">set</span><span class="o">(</span><span class="nc">Subject</span><span class="o">(</span><span class="s">"Hello 2"</span><span class="o">)).</span>
  <span class="n">build</span>
<span class="c1">// mail2: emil.Mail[cats.effect.IO] =
// Mail(MailHeader(,None,None,Recipients(List(MailAddress(None,me2@test.com)),List(),List()),None,Some(MailAddress(None,me@test.com)),None,None,None,Hello 2,Set()),Headers(List(Header(User-Agent,NonEmptyList(my-email-client)))),HtmlAndText(IO(Hello!
// 
// This is a mail.),IO(&lt;h1&gt;Hello!&lt;/h1&gt;
// &lt;p&gt;This &lt;b&gt;is&lt;/b&gt; a mail.&lt;/p&gt;)),Attachments(Vector()))
</span></code></pre></div></div>

<p>The <code class="highlighter-rouge">add</code> and <code class="highlighter-rouge">set</code> methods are both doing the same thing: appending
transfomations. Both names exists for better reading; i.e. a recipient
is by default appended, but the subject is not. The methods accept a
list of transformations, too.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">mail3</span> <span class="k">=</span> <span class="nv">mail2</span><span class="o">.</span><span class="py">asBuilder</span><span class="o">.</span>
  <span class="n">clearRecipients</span><span class="o">.</span>
  <span class="nf">add</span><span class="o">(</span>
    <span class="nc">To</span><span class="o">(</span><span class="s">"me3@test.com"</span><span class="o">),</span>
    <span class="nc">Cc</span><span class="o">(</span><span class="s">"other@test.com"</span><span class="o">)</span>
  <span class="o">).</span>
  <span class="n">build</span>
<span class="c1">// mail3: emil.Mail[cats.effect.IO] =
// Mail(MailHeader(,None,None,Recipients(List(MailAddress(None,me3@test.com)),List(MailAddress(None,other@test.com)),List()),None,Some(MailAddress(None,me@test.com)),None,None,None,Hello 2,Set()),Headers(List(Header(User-Agent,NonEmptyList(my-email-client)))),HtmlAndText(IO(Hello!
// 
// This is a mail.),IO(&lt;h1&gt;Hello!&lt;/h1&gt;
// &lt;p&gt;This &lt;b&gt;is&lt;/b&gt; a mail.&lt;/p&gt;)),Attachments(Vector()))
</span></code></pre></div></div>

<h2 id="mails-with-attachments">Mails with Attachments</h2>

<p>Adding attachments is the same as with other data. Creating
attachemnts might be more involved, depending on where the data is
coming from. Emil defines transformations to add attachments from
files, urls and java’s <code class="highlighter-rouge">InputStream</code> easily. Otherwise you need to get
a <code class="highlighter-rouge">Stream[F, Byte]</code> from somewhere else.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext</span>
<span class="c1">// import scala.concurrent.ExecutionContext
</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="nv">CS</span> <span class="k">=</span> <span class="nv">IO</span><span class="o">.</span><span class="py">contextShift</span><span class="o">(</span><span class="nv">ExecutionContext</span><span class="o">.</span><span class="py">global</span><span class="o">)</span>
<span class="c1">// CS: cats.effect.ContextShift[cats.effect.IO] = cats.effect.internals.IOContextShift@14f17ba
</span>
<span class="k">val</span> <span class="nv">blocker</span> <span class="k">=</span> <span class="nv">Blocker</span><span class="o">.</span><span class="py">liftExecutionContext</span><span class="o">(</span><span class="nv">ExecutionContext</span><span class="o">.</span><span class="py">fromExecutorService</span><span class="o">(</span><span class="nv">java</span><span class="o">.</span><span class="py">util</span><span class="o">.</span><span class="py">concurrent</span><span class="o">.</span><span class="py">Executors</span><span class="o">.</span><span class="py">newCachedThreadPool</span><span class="o">()))</span>
<span class="c1">// blocker: cats.effect.Blocker = cats.effect.Blocker@1b56ee4e
</span>
<span class="k">val</span> <span class="nv">mail4</span> <span class="k">=</span> <span class="nv">mail3</span><span class="o">.</span><span class="py">asBuilder</span><span class="o">.</span><span class="py">add</span><span class="o">(</span>
  <span class="nc">AttachUrl</span><span class="o">[</span><span class="kt">IO</span><span class="o">](</span><span class="nv">getClass</span><span class="o">.</span><span class="py">getResource</span><span class="o">(</span><span class="s">"/files/Test.pdf"</span><span class="o">),</span> <span class="n">blocker</span><span class="o">).</span>
    <span class="nf">withFilename</span><span class="o">(</span><span class="s">"test.pdf"</span><span class="o">).</span>
    <span class="nf">withMimeType</span><span class="o">(</span><span class="nv">MimeType</span><span class="o">.</span><span class="py">pdf</span><span class="o">)).</span>
  <span class="n">build</span>
<span class="c1">// mail4: emil.Mail[cats.effect.IO] =
// Mail(MailHeader(,None,None,Recipients(List(MailAddress(None,me3@test.com)),List(MailAddress(None,other@test.com)),List()),None,Some(MailAddress(None,me@test.com)),None,None,None,Hello 2,Set()),Headers(List(Header(User-Agent,NonEmptyList(my-email-client)))),HtmlAndText(IO(Hello!
// 
// This is a mail.),IO(&lt;h1&gt;Hello!&lt;/h1&gt;
// &lt;p&gt;This &lt;b&gt;is&lt;/b&gt; a mail.&lt;/p&gt;)),Attachments(Vector(Attachment(Some(test.pdf),MimeType(application,pdf,Map()),Stream(..),&lt;function1&gt;))))
</span></code></pre></div></div>

<p>Emil creates a <code class="highlighter-rouge">Stream[F, Byte]</code> from the <code class="highlighter-rouge">java.net.URL</code> using the
<a href="">fs2-io</a> api, that requires a <code class="highlighter-rouge">Blocker</code> and a <code class="highlighter-rouge">ContextShift</code>. The
same applies when attaching files and <code class="highlighter-rouge">java.io.InputStream</code>s.</p>

<p>Attaching any given <code class="highlighter-rouge">Stream[F, Byte]</code> is the same. It doesn’t require
<code class="highlighter-rouge">Blocker</code> or <code class="highlighter-rouge">ContextShift</code> then.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">fs2.Stream</span>
<span class="c1">// import fs2.Stream
</span>
<span class="k">val</span> <span class="nv">mydata</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">IO</span>, <span class="kt">Byte</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Stream</span><span class="o">.</span><span class="py">empty</span><span class="o">.</span><span class="py">covary</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
<span class="c1">// mydata: fs2.Stream[cats.effect.IO,Byte] = Stream(..)
</span>
<span class="k">val</span> <span class="nv">mail5</span> <span class="k">=</span> <span class="nv">mail4</span><span class="o">.</span><span class="py">asBuilder</span><span class="o">.</span>
  <span class="n">clearAttachments</span><span class="o">.</span>
  <span class="nf">add</span><span class="o">(</span>
    <span class="nc">Attach</span><span class="o">(</span><span class="n">mydata</span><span class="o">).</span>
      <span class="nf">withFilename</span><span class="o">(</span><span class="s">"empty.txt"</span><span class="o">)</span>
  <span class="o">).</span>
  <span class="n">build</span>
<span class="c1">// mail5: emil.Mail[cats.effect.IO] =
// Mail(MailHeader(,None,None,Recipients(List(MailAddress(None,me3@test.com)),List(MailAddress(None,other@test.com)),List()),None,Some(MailAddress(None,me@test.com)),None,None,None,Hello 2,Set()),Headers(List(Header(User-Agent,NonEmptyList(my-email-client)))),HtmlAndText(IO(Hello!
// 
// This is a mail.),IO(&lt;h1&gt;Hello!&lt;/h1&gt;
// &lt;p&gt;This &lt;b&gt;is&lt;/b&gt; a mail.&lt;/p&gt;)),Attachments(Vector(Attachment(Some(empty.txt),MimeType(application,octet-stream,Map()),Stream(..),&lt;function1&gt;))))
</span></code></pre></div></div>

<h2 id="custom-transformations">Custom Transformations</h2>

<p>Customs transformations can be easily created. It’s only a function
<code class="highlighter-rouge">Mail[F] =&gt; Mail[F]</code>. This can be handy, if there is a better way to
retrieve attachments, or just to create common headers.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">object</span> <span class="nc">MyHeader</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">apply</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="n">value</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Trans</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">CustomHeader</span><span class="o">(</span><span class="s">"X-My-Header"</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// defined object MyHeader
</span>
<span class="k">val</span> <span class="nv">mymail</span> <span class="k">=</span> <span class="nv">MailBuilder</span><span class="o">.</span><span class="py">build</span><span class="o">(</span>
  <span class="nc">To</span><span class="o">(</span><span class="s">"me@test.com"</span><span class="o">),</span>
  <span class="nc">MyHeader</span><span class="o">(</span><span class="s">"blablabla"</span><span class="o">),</span>
  <span class="nc">TextBody</span><span class="o">(</span><span class="s">"This is a text"</span><span class="o">)</span>
<span class="o">)</span>
<span class="c1">// mymail: emil.Mail[cats.package.Id] = Mail(MailHeader(,None,None,Recipients(List(MailAddress(None,me@test.com)),List(),List()),None,None,None,None,None,,Set()),Headers(List(Header(X-My-Header,NonEmptyList(blablabla)))),Text(This is a text),Attachments(Vector()))
</span></code></pre></div></div>

<p>The above example simply delegates to an existing <code class="highlighter-rouge">Trans</code> constructor.</p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/emil/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script src="/emil/js/main.js"></script></body></html>