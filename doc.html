<html><head><title>Emil: Documentation</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="eikek" /><meta name="description" content="Emil – E-Mail library for Scala" /><meta name="og:image" content="/emil/img/poster.png" /><meta name="image" property="og:image" content="/emil/img/poster.png" /><meta name="og:title" content="Emil: Documentation" /><meta name="title" property="og:title" content="Emil: Documentation" /><meta name="og:site_name" content="Emil" /><meta name="og:url" content="https://github.com/eikek/emil" /><meta name="og:type" content="website" /><meta name="og:description" content="Emil – E-Mail library for Scala" /><link rel="icon" type="image/png" href="/emil/img/favicon.png" /><meta name="twitter:title" content="Emil: Documentation" /><meta name="twitter:image" content="/emil/img/poster.png" /><meta name="twitter:description" content="Emil – E-Mail library for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="96x96" href="/emil/img/favicon.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/emil/highlight/styles/default.css" /><link rel="stylesheet" href="/emil/css/style.css" /><link rel="stylesheet" href="/emil/css/palette.css" /><link rel="stylesheet" href="/emil/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/emil/" class="brand"><div class="brand-wrapper"><span>Emil</span></div></a></li> <li><a href="/emil/index.html" class="">Home</a></li> <li><a href="/emil/examples.html" class="">Examples</a></li> <li><a href="/emil/doc.html" class=" active ">Documentation</a> <ul class="sub_section"> <li><a href="/emil/doc/building.html" class="">Creating Mails</a></li> <li><a href="/emil/doc/reading.html" class="">Obtaining Mails</a></li> <li><a href="/emil/doc/syntax.html" class="">Syntax Utilities</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/eikek/emil"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/eikek/emil"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="eikek" data-github-repo="emil"><div class="content-wrapper"><section><h1 id="documentation">Documentation</h1>

<p>Emil consists of multiple modules. The core is <code class="highlighter-rouge">emil-common</code>. It
defines the data structures for representing an e-mail and the
<code class="highlighter-rouge">MailOp</code>, a generic interface for “doing something with it”.</p>

<h2 id="mail-model">Mail Model</h2>

<p>Emil uses a simplified model of an e-mail. With
<a href="https://en.wikipedia.org/wiki/MIME">MIME</a>, an e-mail can appear in
various shapes. Emil uses a flat structure, being:</p>

<ol>
  <li>Headers</li>
  <li>Body</li>
  <li>Attachments</li>
</ol>

<p>The <code class="highlighter-rouge">Headers</code> are the standard headers in an e-mail. The <code class="highlighter-rouge">Body</code>
defines the content of the mail. It can be specified as plain text,
HTML or both. In case both is specified it defines the same content,
just a different format. It is translated into a
<code class="highlighter-rouge">multipart/alternative</code> message.</p>

<p>Then a list of attachments follows. The major difference to MIME is
that it is not recursive. Emil can only create <em>Mixed</em> or
<em>Alternative</em> MIME messages.</p>

<h2 id="mailop">MailOp</h2>

<p>The other concept is the <code class="highlighter-rouge">MailOp</code>, which is an alias for the cats
<code class="highlighter-rouge">Kleisli</code> class, fixing the input type to <code class="highlighter-rouge">Connection</code>. Every code
that does something with an e-mail runs inside such a function.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>type MailOp[F[_], C &lt;: Connection, A] = Kleisli[F, C, A]
</code></pre></div></div>

<p>There are pre-defined primitive operations in the <code class="highlighter-rouge">Access</code> and <code class="highlighter-rouge">Send</code>
trait, respectively. These are implemented by some “implementation
module”. You can compose the primitive operations into custom ones
without depending on a concrete implementation module.</p>

<p>For example, this is an operation that moves the first mail in INBOX
into the Trash folder:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.implicits._</span><span class="o">,</span> <span class="nv">cats</span><span class="o">.</span><span class="py">effect</span><span class="o">.</span><span class="py">_</span><span class="o">,</span> <span class="nv">emil</span><span class="o">.</span><span class="py">_</span>
<span class="c1">// import cats.implicits._
// import cats.effect._
// import emil._
</span>
<span class="k">def</span> <span class="nf">moveToTrash</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:</span> <span class="kt">Sync</span>, <span class="kt">C</span> <span class="k">&lt;:</span> <span class="kt">Connection</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">Access</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">C</span><span class="o">])</span><span class="k">:</span> <span class="kt">MailOp</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">C</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">trash</span> <span class="k">=</span> <span class="nv">a</span><span class="o">.</span><span class="py">getOrCreateFolder</span><span class="o">(</span><span class="nc">None</span><span class="o">,</span> <span class="s">"Trash"</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">findFirstMail</span> <span class="k">=</span> <span class="nv">a</span><span class="o">.</span><span class="py">getInbox</span><span class="o">.</span>
    <span class="nf">flatMap</span><span class="o">(</span><span class="n">in</span> <span class="k">=&gt;</span> <span class="nv">a</span><span class="o">.</span><span class="py">search</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="mi">1</span><span class="o">)(</span><span class="nv">SearchQuery</span><span class="o">.</span><span class="py">All</span><span class="o">)).</span>
    <span class="nf">map</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">mails</span><span class="o">.</span><span class="py">headOption</span><span class="o">.</span><span class="py">toRight</span><span class="o">(</span><span class="k">new</span> <span class="nc">Exception</span><span class="o">(</span><span class="s">"No mail found."</span><span class="o">))).</span>
    <span class="nf">mapF</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">rethrow</span><span class="o">)</span>

  <span class="k">for</span> <span class="o">{</span>
    <span class="n">target</span> <span class="k">&lt;-</span> <span class="n">trash</span>
    <span class="n">mail</span>   <span class="k">&lt;-</span> <span class="n">findFirstMail</span>
    <span class="k">_</span>      <span class="k">&lt;-</span> <span class="nv">a</span><span class="o">.</span><span class="py">moveMail</span><span class="o">(</span><span class="n">mail</span><span class="o">,</span> <span class="n">target</span><span class="o">)</span>
  <span class="o">}</span> <span class="nf">yield</span> <span class="o">()</span>
<span class="o">}</span>
<span class="c1">// moveToTrash: [F[_], C &lt;: emil.Connection](a: emil.Access[F,C])(implicit evidence$1: cats.effect.Sync[F])emil.MailOp[F,C,Unit]
</span></code></pre></div></div>

<p>This uses only imports from <code class="highlighter-rouge">emil-common</code>.</p>

<h2 id="implementation">Implementation</h2>

<p>The module <code class="highlighter-rouge">emil-common</code> lets you define mails and operations among
them. To actually execute these operations, an implementation module
is necessary. Currently there is <code class="highlighter-rouge">emil-javamail</code>, that is based on the
<a href="https://github.com/eclipse-ee4j/mail">JavaMail</a> library.</p>

<p>This module provides a factory for creating concrete <code class="highlighter-rouge">Connection</code>
instances. The <code class="highlighter-rouge">emil-javamail</code> module has a <code class="highlighter-rouge">ConnectionResource</code> that
creates a <code class="highlighter-rouge">Resource[F, JavaMailConnection]</code> given some
<code class="highlighter-rouge">MailConfig</code>. This can be used to run the <code class="highlighter-rouge">MailOp</code> operations.</p>

<p>The <code class="highlighter-rouge">Emil</code> trait exists to make this more convenient. It simply
combines the <code class="highlighter-rouge">ConnectionResource</code> and the implementations for the
primitive <code class="highlighter-rouge">MailOp</code>s (defined in <code class="highlighter-rouge">Access</code> and <code class="highlighter-rouge">Send</code> trait). The
<code class="highlighter-rouge">emil-javamail</code> modul provides this as <code class="highlighter-rouge">JavaMailEmil</code>.</p>

<p>For example, to execute the <em>“moveToTrash”</em> operation from above, one
needs a corresponding connection to some imap server and the
<code class="highlighter-rouge">JavaMailEmil</code>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">emil.javamail._</span><span class="o">,</span> <span class="nv">scala</span><span class="o">.</span><span class="py">concurrent</span><span class="o">.</span><span class="py">ExecutionContext</span>
<span class="c1">// import emil.javamail._
// import scala.concurrent.ExecutionContext
</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="nv">CS</span> <span class="k">=</span> <span class="nv">IO</span><span class="o">.</span><span class="py">contextShift</span><span class="o">(</span><span class="nv">ExecutionContext</span><span class="o">.</span><span class="py">global</span><span class="o">)</span>
<span class="c1">// CS: cats.effect.ContextShift[cats.effect.IO] = cats.effect.internals.IOContextShift@5eb7f4fd
</span>
<span class="k">val</span> <span class="nv">blocker</span> <span class="k">=</span> <span class="nv">Blocker</span><span class="o">.</span><span class="py">liftExecutionContext</span><span class="o">(</span><span class="nv">ExecutionContext</span><span class="o">.</span><span class="py">fromExecutorService</span><span class="o">(</span><span class="nv">java</span><span class="o">.</span><span class="py">util</span><span class="o">.</span><span class="py">concurrent</span><span class="o">.</span><span class="py">Executors</span><span class="o">.</span><span class="py">newCachedThreadPool</span><span class="o">()))</span>
<span class="c1">// blocker: cats.effect.Blocker = cats.effect.Blocker@7c6cb8da
</span>
<span class="k">val</span> <span class="nv">emil</span> <span class="k">=</span> <span class="nc">JavaMailEmil</span><span class="o">[</span><span class="kt">IO</span><span class="o">](</span><span class="n">blocker</span><span class="o">)</span>
<span class="c1">// emil: emil.Emil[cats.effect.IO,emil.javamail.internal.JavaMailConnection] = emil.javamail.JavaMailEmil@2ee4a358
</span>
<span class="k">val</span> <span class="nv">imapConf</span> <span class="k">=</span> <span class="nc">MailConfig</span><span class="o">(</span><span class="s">"imap://devmail:143"</span><span class="o">,</span> <span class="s">"dev"</span><span class="o">,</span> <span class="s">"dev"</span><span class="o">,</span> <span class="nv">SSLType</span><span class="o">.</span><span class="py">NoEncryption</span><span class="o">)</span>
<span class="c1">// imapConf: emil.MailConfig = MailConfig(imap://devmail:143, dev, ***, NoEncryption, 10 seconds)
</span>
<span class="k">val</span> <span class="nv">moveIO</span> <span class="k">=</span> <span class="nf">emil</span><span class="o">(</span><span class="n">imapConf</span><span class="o">).</span><span class="py">run</span><span class="o">(</span><span class="nf">moveToTrash</span><span class="o">(</span><span class="nv">emil</span><span class="o">.</span><span class="py">access</span><span class="o">))</span>
<span class="c1">// moveIO: cats.effect.IO[Unit] = IO$212823725
</span></code></pre></div></div>

<p>First, we need to create a <code class="highlighter-rouge">ContextShift</code> instance and a
<code class="highlighter-rouge">Blocker</code>. Reason is that JavaMail uses blocking IO and the
<code class="highlighter-rouge">JavaMailEmil</code> shifts the execution of all primitive operations onto
the blocking execution context, given as <code class="highlighter-rouge">Blocker</code>.</p>

<p>Note: The <code class="highlighter-rouge">emil-javamail</code> depends on the
<a href="https://github.com/eclipse-ee4j/mail">JavaMail</a> library, which has a
dual license: EPL and GPLv2 with Classpath exception.</p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/emil/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script src="/emil/js/main.js"></script></body></html>