<html><head><title>Emil: Documentation</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="eikek" /><meta name="description" content="Emil – E-Mail library for Scala" /><meta name="og:image" content="/emil/img/poster.png" /><meta name="image" property="og:image" content="/emil/img/poster.png" /><meta name="og:title" content="Emil: Documentation" /><meta name="title" property="og:title" content="Emil: Documentation" /><meta name="og:site_name" content="Emil" /><meta name="og:url" content="https://github.com/eikek/emil" /><meta name="og:type" content="website" /><meta name="og:description" content="Emil – E-Mail library for Scala" /><link rel="icon" type="image/png" href="/emil/img/favicon.png" /><meta name="twitter:title" content="Emil: Documentation" /><meta name="twitter:image" content="/emil/img/poster.png" /><meta name="twitter:description" content="Emil – E-Mail library for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="96x96" href="/emil/img/favicon.png" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/emil/highlight/styles/vs.css" /><link rel="stylesheet" href="/emil/css/light-style.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><div id="sidebar-brand"><a href="/emil/" class="brand"><div class="brand-wrapper"></div><span>Emil</span></a><button id="main-toggle" class="sidebar-toggle"><span class="close"></span></button></div><div class="sidebar-nav"> <div class="sidebar-nav-item  "><a href="/emil/index.html" title="Home" class="">Home</a></div> <div class="sidebar-nav-item  "><a href="/emil/examples.html" title="Examples" class="">Examples</a></div> <div class="sidebar-nav-item active open"><a href="/emil/doc.html" title="Documentation" class="drop-nested">Documentation</a><i class="fa fa-angle-right"></i><div class="sub-section"> <a href="/emil/doc/building.html" title="Creating Mails" class="">Creating Mails</a> <a href="/emil/doc/reading.html" title="Obtaining Mails" class="">Obtaining Mails</a> <a href="/emil/doc/syntax.html" title="Syntax Utilities" class="">Syntax Utilities</a></div></div></div></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/eikek/emil" target="_blank" rel="noopener noreferrer"><i class="fa fa-eye"></i><span>Watchers<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/eikek/emil" target="_blank" rel="noopener noreferrer"><i class="fa fa-star-o"></i><span>Stars<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="eikek" data-github-repo="emil"><div class="content-wrapper"><section><h1 id="documentation">Documentation</h1>

<p>Emil consists of multiple modules. The core is <code class="highlighter-rouge">emil-common</code>. It
defines the data structures for representing an e-mail and the
<code class="highlighter-rouge">MailOp</code>, a generic interface for “doing something with it”.</p>

<h2 id="mail-model">Mail Model</h2>

<p>Emil uses a simplified model of an e-mail. With
<a href="https://en.wikipedia.org/wiki/MIME">MIME</a>, an e-mail can appear in
various shapes. Emil uses a flat structure, being:</p>

<ol>
  <li>Headers</li>
  <li>Body</li>
  <li>Attachments</li>
</ol>

<p>The <code class="highlighter-rouge">Headers</code> are the standard headers in an e-mail. The <code class="highlighter-rouge">Body</code>
defines the content of the mail. It can be specified as plain text,
HTML or both. In case both is specified it defines the same content,
just a different format. It is translated into a
<code class="highlighter-rouge">multipart/alternative</code> message.</p>

<p>Then a list of attachments follows. The major difference to MIME is
that it is not recursive. Emil can only create <em>Mixed</em> or
<em>Alternative</em> MIME messages.</p>

<h2 id="mailop">MailOp</h2>

<p>The other concept is the <code class="highlighter-rouge">MailOp</code>, which is an alias for the cats
<code class="highlighter-rouge">Kleisli</code> class, fixing the input type to <code class="highlighter-rouge">Connection</code>. Every code
that does something with an e-mail runs inside such a function.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>type MailOp[F[_], C &lt;: Connection, A] = Kleisli[F, C, A]
</code></pre></div></div>

<p>There are pre-defined primitive operations in the <code class="highlighter-rouge">Access</code> and <code class="highlighter-rouge">Send</code>
trait, respectively. These are implemented by some “implementation
module”. You can compose the primitive operations into custom ones
without depending on a concrete implementation module.</p>

<p>For example, this is an operation that moves the first mail in INBOX
into the Trash folder:</p>

<pre><code class="language-tut:book">import cats.implicits._, cats.effect._, emil._

def moveToTrash[F[_]: Sync, C &lt;: Connection](a: Access[F, C]): MailOp[F, C, Unit] = {
  val trash = a.getOrCreateFolder(None, "Trash")
  val findFirstMail = a.getInbox.
    flatMap(in =&gt; a.search(in, 1)(SearchQuery.All)).
    map(_.mails.headOption.toRight(new Exception("No mail found."))).
    mapF(_.rethrow)

  for {
    target &lt;- trash
    mail   &lt;- findFirstMail
    _      &lt;- a.moveMail(mail, target)
  } yield ()
}
</code></pre>

<p>This uses only imports from <code class="highlighter-rouge">emil-common</code>.</p>

<h2 id="implementation">Implementation</h2>

<p>The module <code class="highlighter-rouge">emil-common</code> lets you define mails and operations among
them. To actually execute these operations, an implementation module
is necessary. Currently there is <code class="highlighter-rouge">emil-javamail</code>, that is based on the
<a href="https://github.com/eclipse-ee4j/mail">JavaMail</a> library.</p>

<p>This module provides a factory for creating concrete <code class="highlighter-rouge">Connection</code>
instances. The <code class="highlighter-rouge">emil-javamail</code> module has a <code class="highlighter-rouge">ConnectionResource</code> that
creates a <code class="highlighter-rouge">Resource[F, JavaMailConnection]</code> given some
<code class="highlighter-rouge">MailConfig</code>. This can be used to run the <code class="highlighter-rouge">MailOp</code> operations.</p>

<p>The <code class="highlighter-rouge">Emil</code> trait exists to make this more convenient. It simply
combines the <code class="highlighter-rouge">ConnectionResource</code> and the implementations for the
primitive <code class="highlighter-rouge">MailOp</code>s (defined in <code class="highlighter-rouge">Access</code> and <code class="highlighter-rouge">Send</code> trait). The
<code class="highlighter-rouge">emil-javamail</code> modul provides this as <code class="highlighter-rouge">JavaMailEmil</code>.</p>

<p>For example, to execute the <em>“moveToTrash”</em> operation from above, one
needs a corresponding connection to some imap server and the
<code class="highlighter-rouge">JavaMailEmil</code>.</p>

<pre><code class="language-tut:book">import emil.javamail._, scala.concurrent.ExecutionContext

implicit val CS = IO.contextShift(ExecutionContext.global)
val blocker = Blocker.liftExecutionContext(ExecutionContext.fromExecutorService(java.util.concurrent.Executors.newCachedThreadPool()))

val emil = JavaMailEmil[IO](blocker)
val imapConf = MailConfig("imap://devmail:143", "dev", "dev", SSLType.NoEncryption)

val moveIO = emil(imapConf).run(moveToTrash(emil.access))
</code></pre>

<p>First, we need to create a <code class="highlighter-rouge">ContextShift</code> instance and a
<code class="highlighter-rouge">Blocker</code>. Reason is that JavaMail uses blocking IO and the
<code class="highlighter-rouge">JavaMailEmil</code> shifts the execution of all primitive operations onto
the blocking execution context, given as <code class="highlighter-rouge">Blocker</code>.</p>

<p>Note: The <code class="highlighter-rouge">emil-javamail</code> depends on the
<a href="https://github.com/eclipse-ee4j/mail">JavaMail</a> library, which has a
dual license: EPL and GPLv2 with Classpath exception.</p>
</section></div></div></div></div><script src="/emil/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlightingOnLoad();
              </script><script>console.info('\x57\x65\x62\x73\x69\x74\x65\x20\x62\x75\x69\x6c\x74\x20\x77\x69\x74\x68\x3a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x5f\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x5f\x20\x5f\x5f\x0a\x20\x20\x20\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x5f\x20\x20\x2f\x20\x2f\x5f\x20\x20\x20\x20\x20\x20\x5f\x5f\x5f\x5f\x20\x5f\x5f\x5f\x20\x20\x28\x5f\x29\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x28\x5f\x29\x20\x2f\x5f\x5f\x5f\x5f\x20\x20\x5f\x5f\x5f\x5f\x5f\x0a\x20\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x60\x5f\x5f\x20\x5c\x2f\x20\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x5f\x2f\x20\x5f\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x20\x2f\x20\x5f\x5f\x2f\x20\x5f\x20\x5c\x2f\x20\x5f\x5f\x5f\x2f\x0a\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x5f\x2f\x20\x2f\x20\x2f\x5f\x2f\x5f\x5f\x5f\x5f\x5f\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x20\x2f\x5f\x5f\x2f\x20\x2f\x20\x20\x2f\x20\x2f\x5f\x2f\x20\x28\x5f\x5f\x20\x20\x29\x20\x2f\x20\x2f\x5f\x2f\x20\x20\x5f\x5f\x28\x5f\x5f\x20\x20\x29\x0a\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2e\x5f\x5f\x5f\x2f\x5c\x5f\x5f\x2f\x20\x20\x20\x20\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x20\x2f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x2f\x20\x20\x20\x5c\x5f\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x5f\x2f\x5c\x5f\x5f\x2f\x5c\x5f\x5f\x5f\x2f\x5f\x5f\x5f\x5f\x2f\x0a\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x34\x37\x64\x65\x67\x2e\x67\x69\x74\x68\x75\x62\x2e\x69\x6f\x2f\x73\x62\x74\x2d\x6d\x69\x63\x72\x6f\x73\x69\x74\x65\x73')</script><script src="/emil/js/docs.js"></script></body></html>